<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <style type="text/css">
        body, html {
            width: 100%;
            height: 100%;
            margin: 0;
            font-family: "微软雅黑";
        }

        #l-map {
            height: 300px;
            width: 100%;
        }

        #r-result {
            width: 100%;
        }
    </style>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=75NKDW73M2AYHu1xtPTGjDH1niOLCDbi"></script>
    <title>本地搜索的结果面板</title>
</head>
<body>
<div id="l-map"></div>
<div id="r-result"></div>
</body>
</html>


<!-- 全局js -->
<script src="file:///android_asset/js/jquery.min.js?v=2.1.4"></script>
<script src="file:///android_asset/js/bootstrap.min.js?v=3.3.6"></script>
<script type="text/javascript">

    // var jsonstr = window.MyBrowserAPI.getLocationData("从页面传给手机的message");//拿到本地数据,并可以传给手机一些内容，可选
    var jsonstr = '[{"pingpai":"小米","xinghao":"MIX2","yingjian":"八核6GB","anzhuo":"8.0","wangluo":"LTE","leixing":"类型","jingdu":"117.49388","weidu":"30.64623","jingque":"100米","fangshi":"GPS","dizhi":"安徽省池州市贵池区长江中路126号","shuju":"LTE","xiaoqu":"LTE","tac":"6245","pci":"122","eci":"6245","band":"3","earf":"6245","freq":"1","nid":"2","bid":"3","sid":"4","rsrp":"-100","rsrq":"8","snir":"10","dbm":"-80","ecio":"8","time":"09:41:30","tac":"28688","enb":"43017","cellid":"54"},{"pingpai":"小米","xinghao":"MIX2","yingjian":"八核6GB","anzhuo":"8.0","wangluo":"LTE","leixing":"类型","jingdu":"117.30333","weidu":"30.44556","jingdu":"100米","fangshi":"GPS","dizhi":"安徽省池州市贵池区长江中路126号","shuju":"LTE","xiaoqu":"LTE","tac":"6245","pci":"122","eci":"6245","band":"3","earf":"6245","freq":"1","nid":"2","bid":"3","sid":"4","rsrp":"-100","rsrq":"8","snir":"10","dbm":"-80","ecio":"8","time":"09:41:30","tac":"28688","enb":"43017","cellid":"54"},{"pingpai":"小米","xinghao":"MIX2","yingjian":"八核6GB","anzhuo":"8.0","wangluo":"LTE","leixing":"类型","jingdu":"117.30333","weidu":"30.44556","jingdu":"100米","fangshi":"GPS","dizhi":"安徽省池州市贵池区长江中路126号","shuju":"LTE","xiaoqu":"LTE","tac":"6245","pci":"122","eci":"6245","band":"3","earf":"6245","freq":"1","nid":"2","bid":"3","sid":"4","rsrp":"-100","rsrq":"8","snir":"10","dbm":"-80","ecio":"8","time":"09:41:30","tac":"28688","enb":"43017","cellid":"54"},{"pingpai":"小米","xinghao":"MIX2","yingjian":"八核6GB","anzhuo":"8.0","wangluo":"LTE","leixing":"类型","jingdu":"117.30333","weidu":"30.44556","jingdu":"100米","fangshi":"GPS","dizhi":"安徽省池州市贵池区长江中路126号","shuju":"LTE","xiaoqu":"LTE","tac":"6245","pci":"122","eci":"6245","band":"3","earf":"6245","freq":"1","nid":"2","bid":"3","sid":"4","rsrp":"-100","rsrq":"8","snir":"10","dbm":"-80","ecio":"8","time":"09:41:30","tac":"28688","enb":"43017","cellid":"54"},{"pingpai":"小米","xinghao":"MIX2","yingjian":"八核6GB","anzhuo":"8.0","wangluo":"LTE","leixing":"类型","jingdu":"117.30333","weidu":"30.44556","jingdu":"100米","fangshi":"GPS","dizhi":"安徽省池州市贵池区长江中路126号","shuju":"LTE","xiaoqu":"LTE","tac":"6245","pci":"122","eci":"6245","band":"3","earf":"6245","freq":"1","nid":"2","bid":"3","sid":"4","rsrp":"-100","rsrq":"8","snir":"10","dbm":"-80","ecio":"8","time":"09:41:30","tac":"28688","enb":"43017","cellid":"54"},{"pingpai":"小米","xinghao":"MIX2","yingjian":"八核6GB","anzhuo":"8.0","wangluo":"LTE","leixing":"类型","jingdu":"117.30333","weidu":"30.44556","jingque":"100米","fangshi":"GPS","dizhi":"安徽省池州市贵池区长江中路126号","shuju":"LTE","xiaoqu":"LTE","tac":"6245","pci":"122","eci":"6245","band":"3","earf":"6245","freq":"1","nid":"2","bid":"3","sid":"4","rsrp":"-100","rsrq":"8","snir":"10","dbm":"-80","ecio":"8","time":"09:41:30","tac":"28688","enb":"43017","cellid":"54"}]';
    // var jsonstr = '[{"rsrp":"-98"},{"rsrp":"-102"},{"rsrp":"-97"},{},{},{},{},{},{}]';
    var xinxiObj = JSON.parse(jsonstr);
    var xinxiList = [];
    var firstJson = {};
    var first = true;
    var ceshijiluhtml = "";
    $.each(xinxiObj, function (i, item) {
        var tmpist = [];
        var rsrp = 0;
        if (item['rsrp'] !== '') {
            rsrp = parseFloat(item['rsrp'])
        }
        tmpist.push(i, rsrp);
        xinxiList.push(tmpist);
        if (first === true) {
            firstJson = item;
            first = false;
        }
        ceshijiluhtml = ceshijiluhtml +
            "    <tr>\n" +
            "        <td>" + item['time'] + "</td>\n" +
            "        <td>" + item['pci'] + "</td>\n" +
            "        <td>" + item['rsrp'] + "</td>\n" +
            "        <td>" + item['sinr'] + "</td>\n" +
            "        <td>" + item['dbm'] + "</td>\n" +
            "        <td>" + item['ecio'] + "</td>\n" +
            "    </tr>\n";

    });

    // 百度地图API功能
    var map = new BMap.Map("l-map");            // 创建Map实例


    var points = [new BMap.Point(firstJson['jingdu'], firstJson['weidu'])];
    var myGeo = new BMap.Geocoder();

    //坐标转换完之后的回调函数
    translateCallback = function (data) {
        if (data.status === 0) {
            for (var i = 0; i < data.points.length; i++) {

                var mPoint = new BMap.Point(data.points[i]['lng'], data.points[i]['lat']);
                map.enableScrollWheelZoom();
                map.centerAndZoom(mPoint, 15);
                var circle = new BMap.Circle(mPoint, 1000, {
                    fillColor: "blue",
                    strokeWeight: 1,
                    fillOpacity: 0.3,
                    strokeOpacity: 0.3
                });
                map.addOverlay(circle);

                var local = new BMap.LocalSearch(map, {
                    renderOptions: {map: map, panel: "r-result"}
                });
                local.searchNearby(["住宅", "机构", "酒店", "超市", "餐饮", "村", "路"], mPoint, 500);
                local.setResultsHtmlSetCallback(function (result) {
                    /*返回最近一次检索的结果*/
                    $.each($("ol li"), function () {
                        console.log(this);
                        $(this).bind("click",this,function () {
                            console.log( $(this)[0]['innerText'] );
                        });
                    });
                });

            }
        }
    };

    setTimeout(function () {
        var convertor = new BMap.Convertor();
        convertor.translate(points, 1, 5, translateCallback)
    }, 1000);


</script>
